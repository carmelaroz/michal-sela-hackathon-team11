<!-- <!DOCTYPE html>
<html>
<head>
  <title>ניווט עם Leaflet</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
  <script>
    const map = L.map('map').setView([32.0853, 34.7818], 13); // תל אביב

    // שכבת מפה בסיסית
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // === 1. הצגת מיקום המשתמש ===
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async function (position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`;

        try {
          const res = await fetch(url, {
            headers: {
              'Accept-Language': 'he',
              'User-Agent': 'MyLeafletApp'
            }
          });
          const data = await res.json();
          const address = data.display_name || "לא נמצאה כתובת";

          L.circleMarker([lat, lng], {
            radius: 10,
            color: 'red',
            fillColor: 'red',
            fillOpacity: 0.8
          }).addTo(map)
            .bindPopup(`<b>את/ה כאן:</b><br>${address}`)
            .openPopup();

          map.setView([lat, lng], 14);

          // === 2. ניווט לנקודה פיקטיבית ===
          const destination = [32.079, 34.78]; // יעד דמיוני

          L.Routing.control({
            waypoints: [
              L.latLng(lat, lng), // מיקום המשתמש
              L.latLng(destination) // מיקום היעד
            ],
            routeWhileDragging: true // יכולת לגרור את הנתיב
          }).addTo(map);
          
        } catch (err) {
          alert("לא הצלחנו להביא את המיקום שלך");
        }
      }, function (err) {
        alert("גישה למיקום נדחתה");
      });
    }

  </script>

</body>
</html> -->












<!DOCTYPE html>
<html>
<head>
  <title>ניווט בזמן אמת עם Leaflet</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
  <script>
    const map = L.map('map').setView([32.0853, 34.7818], 13); // תל אביב

    // שכבת מפה בסיסית
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // משתנים
    let userMarker = null;
    let userLocation = null;
    let routeControl = null;

    // פונקציה לביצוע גיאוקודינג והחזרת קואורדינטות
    async function geocodeAddress(address) {
      const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`);
      const data = await response.json();
      if (data.length > 0) {
        const lat = data[0].lat;
        const lon = data[0].lon;
        return { lat: parseFloat(lat), lng: parseFloat(lon) };
      } else {
        alert('לא נמצאה כתובת');
      }
    }

    // === 1. הגדרת כתובת פיקטיבית ===
    const locations = [
      "מצדה 60, גן יבנה",  // כתובת 1
      "מרבד הקסמים 12, חולון" // כתובת 2
    ];

    // המרת הכתובות לקואורדינטות
    locations.forEach(async (address) => {
      const coordinates = await geocodeAddress(address);
      if (coordinates) {
        L.marker([coordinates.lat, coordinates.lng])
          .addTo(map)
          .bindPopup(address)
          .openPopup();
      }
    });

    // פונקציה לעדכון נתיב
    function updateRoute(lat, lng) {
      if (routeControl) {
        // עדכון הניווט לפי המיקום החדש של המשתמש
        routeControl.setWaypoints([L.latLng(lat, lng), L.latLng(32.079, 34.78)]);
      }
    }

    // === 2. הצגת מיקום המשתמש ===
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(async function (position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        // יצירת או עדכון מיקום המשתמש
        if (!userMarker) {
          userMarker = L.marker([lat, lng], {icon: L.icon({iconUrl: 'https://example.com/user-icon.png'})}).addTo(map);
          map.setView([lat, lng], 14);
          
          // חישוב נתיב דינמי
          routeControl = L.Routing.control({
            waypoints: [
              L.latLng(lat, lng), // מיקום המשתמש
              L.latLng(32.079, 34.78) // יעד דמיוני
            ],
            routeWhileDragging: true
          }).addTo(map);
        } else {
          userMarker.setLatLng([lat, lng]);
          map.setView([lat, lng], 14);
          updateRoute(lat, lng); // עדכון הנתיב עם המיקום החדש
        }
      }, function (err) {
        alert("לא ניתן לקבל את המיקום שלך.");
      }, {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: 5000
      });
    }

  </script>

</body>
</html>
